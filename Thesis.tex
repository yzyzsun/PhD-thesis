\documentclass{mimosis}

\usepackage{metalogo}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Some of my favourite personal adjustments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% These are the adjustments that I consider necessary for typesetting
% a nice thesis. However, they are *not* included in the template, as
% I do not want to force you to use them.

% This ensures that I am able to typeset bold font in table while still aligning the numbers
% correctly.
\usepackage{etoolbox}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Hyperlinks & bookmarks
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[%
  colorlinks = true,
  citecolor  = RedViolet,
  linkcolor  = NavyBlue,
  urlcolor   = NavyBlue,
  backref    = page
]{hyperref}

\renewcommand{\chapterautorefname}{Chapter}
\renewcommand{\sectionautorefname}{Section}
\renewcommand{\subsectionautorefname}{Section}
\renewcommand{\subsubsectionautorefname}{Section}
\renewcommand{\paragraphautorefname}{Section}
\renewcommand{\equationautorefname}{Formula}

\renewcommand*{\backref}[1]{}
\renewcommand*{\backrefalt}[4]{%
    \ifcase #1%
          \or [cited on page~#2]%
          \else [cited on pages~#2]%
    \fi%
    }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Bibliography
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[sort]{natbib}
\setcitestyle{%
    authoryear,%
    open={[},close={]},citesep={;},%
    aysep={},yysep={,},%
    notesep={, }}

% ACM bibliography style looks more professional
\bibliographystyle{ACM-Reference-Format}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Fonts
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\ifxetexorluatex
  \setmainfont{Minion Pro}
\else
  \usepackage[tt=false,type1=true]{libertine}
  \usepackage[varqu]{zi4}
  \usepackage[libertine]{newtxmath}
  % \usepackage[lf]{ebgaramond}
  % \usepackage[oldstyle,scale=0.7]{sourcecodepro}
  % \singlespacing
\fi

\usepackage{CJKutf8}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Ordinals
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\makeatletter
\@ifundefined{st}{%
  \newcommand{\st}{\textsuperscript{\textup{st}}\xspace}
}{}
\@ifundefined{rd}{%
  \newcommand{\rd}{\textsuperscript{\textup{rd}}\xspace}
}{}
\@ifundefined{nd}{%
  \newcommand{\nd}{\textsuperscript{\textup{nd}}\xspace}
}{}
\makeatother

\renewcommand{\th}{\textsuperscript{\textup{th}}\xspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Theorems
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{thmtools}

\newtheoremstyle{acm}%
  {.5\baselineskip\@plus.2\baselineskip
    \@minus.2\baselineskip}% space above
  {.5\baselineskip\@plus.2\baselineskip
    \@minus.2\baselineskip}% space below
  {\itshape}% body font
  {\parindent}% indent amount
  {\scshape}% head font
  {.}% punctuation after head
  {.5em}% spacing after head
  {}% head spec

\theoremstyle{acm}
\newtheorem{theorem}{Theorem}[chapter]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{definition}[theorem]{Definition}
\theoremstyle{remark}
\newtheorem*{remark}{Remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Load my packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage{awesomebox}
\usepackage{comment}
\usepackage{fancyvrb}
\usepackage{multicol}
\usepackage[vskip=1em,font=itshape]{quoting}
\usepackage{wasysym}

\usepackage{makecell}
\renewcommand{\theadfont}{\bfseries}

\usepackage{ottalt}
\inputott{ott/lambda-r}
\inputott{chapters/appendices/ott}
\inputott[IU]{ott/lambda-iu}

\usepackage{listings}
\lstdefinelanguage{CP}{
  keywords={as,case,else,extends,false,fix,fold,forall,if,implements,inherits,interface,in,let,letrec,new,open,override,ref,super,switch,then,toString,trait,true,type,undefined,unfold,with,Bool,Bot,Double,Int,Ref,String,Top,Trait},
  morekeywords={null,Null}, % for pseudocode in Chapter 10
  alsoother={@},
  comment=[l]{--},
  morecomment=[n]{\{-}{-\}},
  string=[b]",
  morestring=[b]`
}
\lstdefinelanguage{TypeScript}{
  keywords={abstract,any,as,asserts,async,await,bigint,boolean,break,case,catch,class,const,constructor,continue,debugger,declare,default,delete,do,else,enum,export,extends,false,finally,for,from,function,get,global,if,implements,import,in,instanceof,interface,is,keyof,let,module,namespace,never,new,null,number,object,of,out,package,private,protected,public,override,readonly,require,return,satisfies,set,static,string,super,switch,symbol,this,throw,true,try,type,typeof,undefined,unique,unknown,var,void,while,with,yield},
  comment=[l]{//},
  morecomment=[s]{/*}{*/},
  string=[b]",
  morestring=[b]',
  morestring=[b]`
}
\lstset{
  columns=fullflexible,
  basicstyle=\ttfamily\small,
  commentstyle=\itshape\color{gray},
  stringstyle=\color{violet},
  literate={->}{{$\rightarrow$}}1 {=>}{{$\Rightarrow$}}1 {<=}{{$\le$}}1 {>=}{{$\ge$}}1 {|->}{{\;$\hookrightarrow$}}1,
  showstringspaces=false,
  keepspaces=true,
  breaklines,
  breakatwhitespace,
  language=CP
}

\usepackage{bbold}
\DeclareSymbolFont{bbsymbol}{U}{bbold}{m}{n}
\DeclareMathSymbol{\bbcomma}{\mathbin}{bbsymbol}{"2C}

\newcommand{\highlight}[1]{\colorbox{lightgray}{#1}}

\newcommand{\fsub}{$F_{<:}$\xspace}
\newcommand{\necolus}{\textsf{NeColus}\xspace}
\newcommand{\lambdac}{$\lambda_c$\xspace}
\newcommand{\lambdar}{$\lambda_r$\xspace}
\newcommand{\fco}{$F_\textsf{co}$\xspace}
\newcommand{\fiplus}{\texorpdfstring{$F_\mathsf{i}^+$}
                                    {Fᵢ⁺}\xspace}
\newcommand{\lambdaiplus}{\texorpdfstring{$\lambda_\mathsf{i}^+$}
                                         {λᵢ⁺}\xspace}
\newcommand{\lambdaiu}{\texorpdfstring{$\lambda_\mathsf{iu}$}
                                      {λᵢᵤ}\xspace}
\newcommand{\uaena}{\textsc{Uaena}\xspace}
\newcommand{\ExT}{\texorpdfstring{E\kern -.1em\lower .4ex\hbox {\footnotesize X}\kern -.2emT}{ExT}\xspace}
\newcommand{\self}{\textsc{Self}\xspace}

%%----------------------------------------------------------------------------%%


\title{Compositional Programming in Action}
\author{Yaozhu Sun}
\date{8 April 2025}


%%----------------------------------------------------------------------------%%
%%    Environment for Title Page                                              %%
%%----------------------------------------------------------------------------%%

\makeatletter
\renewcommand{\maketitle}
{%
  \begin{titlepage}
    \renewcommand{\baselinestretch}{1}
    \begin{center}
      \vspace*{\stretch{3}}
      {\huge\textsf{\textbf{\@title}}\par}
      \vspace*{1.25cm}
      {\large\textit{by}\par}
      \vspace*{1cm}
      {\Large\textsf{\textbf{\@author}}\par}
      {\begin{CJK}{UTF8}{mj}孫 耀 珠\end{CJK}\par}
      \vspace*{\stretch{5}}
      {{\includegraphics[width=30mm]{figures/hku}} \par}
      {\begin{CJK}{UTF8}{mj}香 港 大 學\end{CJK}\par}
      {\hbox{}\par}
      \vspace*{\stretch{5}}
      {
        {\normalsize
        A thesis submitted in partial fulfillment of the requirements for \\
        the degree of Doctor of Philosophy \\
        at the University of Hong Kong \\
        \par
        }
      }
      \vspace*{\stretch{1}}
      {\large\@date\par}
      \vspace*{\stretch{1}}
    \end{center}
  \end{titlepage}
} \makeatother




%%----------------------------------------------------------------------------%%
%%    Environment for Abstract                                                %%
%%----------------------------------------------------------------------------%%

\makeatletter
\newenvironment{abstract}%
{
  \if@twocolumn
    \@restonecoltrue\onecolumn
  \else
    \@restonecolfalse\newpage
  \fi
  \pagestyle{empty}%
  \setcounter{page}\@ne
  \mbox{}
  \newpage
  \pagestyle{empty}%
  \setcounter{page}\@ne
  \cleardoublepage
  \begin{center}
  \large
  Abstract of thesis entitled            \par
  ``\textsf{\textbf{\@title}}''          \par
                                         \vspace*{0.2in}
  Submitted by                           \par
  \textsf{\textbf{\@author}}             \par
                                         \vspace*{0.2in}
  for the degree of Doctor of Philosophy \\
  at the University of Hong Kong         \\
  on \@date
  \end{center}
  \vspace*{0.5in}
}%
{
  \if@restonecol\twocolumn \else \newpage \fi
  \if@twoside\else
  \setcounter{page}\@ne
  \fi
}
\makeatother

%%----------------------------------------------------------------------------%%
%%    Environment for Declaration                                             %%
%%----------------------------------------------------------------------------%%

\makeatletter
\newcommand{\makedecl}
{
\chapter*{Declaration}
\addcontentsline{toc}{chapter}{Declaration}
\noindent I declare that this thesis represents my own work, except
where due acknowledgment is made, and that it has not been
previously included in a thesis, dissertation, or report submitted
to this University or to any other institution for a degree,
diploma, or other qualifications.
\vspace*{1.5in}

\noindent%
\begin{tabular}{@{}l@{}}
\@author\hspace*{3cm}\\
\@date\\
\end{tabular}
}
\makeatother

%%----------------------------------------------------------------------------%%
%%    Environment for Acknowledgments                                         %%
%%----------------------------------------------------------------------------%%

\makeatletter
\newcommand{\makeack}
{
\chapter*{Acknowledgments}
\addcontentsline{toc}{chapter}{Acknowledgments}
\input{chapters/acknowledgments}
}
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Incipit
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

\maketitle

\begin{abstract}
\input{chapters/abstract}
\end{abstract}


%%---------------------%%
\frontmatter
%%---------------------%%
\makedecl
\makeack

\cleardoublepage
\pdfbookmark{Contents}{contents}
\tableofcontents

\KOMAoption{listof}{totoc}
\listoffigures
\listoftables

\clearpage
\phantomsection
\pdfbookmark{List of Theorems}{theorems}
\begingroup
\let\cleardoublepage\clearpage
\listoftheorems
\endgroup

%%---------------------%%
\mainmatter
%%---------------------%%

\part{Prologue} \label{pt:prologue}
\input{chapters/introduction}

\part{Background} \label{pt:background}
\input{chapters/background}
\input{chapters/tutorial}

\part{Why Compositional Programming Matters} \label{pt:why}
\input{chapters/inheritance}
\input{chapters/embedding}

\part{Compilation of Compositional Programming} \label{pt:compile}
\input{chapters/compilation}

\part{Compositional Programming with Union Types} \label{pt:union}
\input{chapters/arguments}

\part{Epilogue} \label{pt:epilogue}
\input{chapters/related}
\input{chapters/conclusion}

\part{Appendices}
\appendix
\input{chapters/appendices}

% This ensures that the subsequent sections are being included as root
% items in the bookmark structure of your PDF reader.
\bookmarksetup{startatroot}

%%---------------------%%
% \backmatter
%%---------------------%%

\cleardoublepage
\bibliography{Thesis,Misc}

\end{document}
