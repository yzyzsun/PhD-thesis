% generated by Ott 0.32 from: ott/lambda-iu.ott
\newcommand{\IUdrule}[4][]{{\displaystyle\frac{\begin{array}{l}#2\end{array}}{#3}\quad\IUdrulename{#4}}}
\newcommand{\IUusedrule}[1]{\[#1\]}
\newcommand{\IUpremise}[1]{ #1 \\}
\newenvironment{IUdefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]}{}
\newenvironment{IUfundefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]\begin{displaymath}\begin{array}{l}}{\end{array}\end{displaymath}}
\newcommand{\IUfunclause}[2]{ #1 \equiv #2 \\}
\newcommand{\IUnt}[1]{\mathit{#1}}
\newcommand{\IUmv}[1]{\mathit{#1}}
\newcommand{\IUkw}[1]{\mathbf{#1}}
\newcommand{\IUsym}[1]{#1}
\newcommand{\IUcom}[1]{\text{#1}}
\newcommand{\IUdrulename}[1]{\textsc{#1}}
\newcommand{\IUcomplu}[5]{\overline{#1}^{\,#2\in #3 #4 #5}}
\newcommand{\IUcompu}[3]{\overline{#1}^{\,#2<#3}}
\newcommand{\IUcomp}[2]{\overline{#1}^{\,#2}}
\newcommand{\IUgrammartabular}[1]{\begin{supertabular}{llcllllll}#1\end{supertabular}}
\newcommand{\IUmetavartabular}[1]{\begin{supertabular}{ll}#1\end{supertabular}}
\newcommand{\IUrulehead}[3]{$#1$ & & $#2$ & & & \multicolumn{2}{l}{#3}}
\newcommand{\IUprodline}[6]{& & $#1$ & $#2$ & $#3 #4$ & $#5$ & $#6$}
\newcommand{\IUfirstprodline}[6]{\IUprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\IUlongprodline}[2]{& & $#1$ & \multicolumn{4}{l}{$#2$}}
\newcommand{\IUfirstlongprodline}[2]{\IUlongprodline{#1}{#2}}
\newcommand{\IUbindspecprodline}[6]{\IUprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\IUprodnewline}{\\}
\newcommand{\IUinterrule}{\\[5.0mm]}
\newcommand{\IUafterlastrule}{\\}
\newcommand{\IUmetavars}{
\IUmetavartabular{
 $ \IUmv{var} ,\, \IUmv{x} ,\, \IUmv{y} ,\, \IUmv{z} ,\, \IUmv{xs} ,\, \IUmv{args} ,\, \IUmv{in\_} ,\, \IUmv{out} ,\, \IUmv{err} ,\, \ell $ & \IUcom{variable/label} \\
}}

\newcommand{\IUtyp}{
\IUrulehead{\IUnt{typ}  ,\ \IUnt{A}  ,\ \IUnt{B}  ,\ \IUnt{C}}{::=}{\IUcom{types}}\IUprodnewline
\IUfirstprodline{|}{ \top }{}{}{}{\IUcom{top type}}\IUprodnewline
\IUprodline{|}{ \bot }{}{}{}{\IUcom{bottom type}}\IUprodnewline
\IUprodline{|}{\IUkw{Null}}{}{}{}{\IUcom{null type}}\IUprodnewline
\IUprodline{|}{ \mathbb{Z} }{}{}{}{\IUcom{integer type}}\IUprodnewline
\IUprodline{|}{\IUnt{A}  \rightarrow  \IUnt{B}}{}{}{}{\IUcom{function type}}\IUprodnewline
\IUprodline{|}{\IUsym{\{}  \ell  \IUsym{:}  \IUnt{A}  \IUsym{\}}}{}{}{}{\IUcom{record type}}\IUprodnewline
\IUprodline{|}{\IUnt{A}  \land  \IUnt{B}}{}{}{}{\IUcom{intersection type}}\IUprodnewline
\IUprodline{|}{\IUnt{A}  \lor  \IUnt{B}}{}{}{}{\IUcom{union type}}\IUprodnewline
\IUprodline{|}{\IUsym{(}  \IUnt{A}  \IUsym{)}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUkw{IO}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUsym{[}  \IUnt{A}  \IUsym{]}} {\textsf{S}}{}{}{}}

\newcommand{\IUord}{
\IUrulehead{\IUnt{ord}  ,\ A^\circ  ,\ B^\circ}{::=}{\IUcom{ordinary types}}\IUprodnewline
\IUfirstprodline{|}{\IUkw{Null}}{}{}{}{}\IUprodnewline
\IUprodline{|}{ \mathbb{Z} }{}{}{}{}\IUprodnewline
\IUprodline{|}{\IUnt{A}  \rightarrow  \IUnt{B}}{}{}{}{}\IUprodnewline
\IUprodline{|}{\IUsym{\{}  \ell  \IUsym{:}  \IUnt{A}  \IUsym{\}}}{}{}{}{}}

\newcommand{\IUexp}{
\IUrulehead{\IUnt{exp}  ,\ \IUnt{e}  ,\ \IUnt{d}  ,\ \IUnt{E}}{::=}{\IUcom{expressions}}\IUprodnewline
\IUfirstprodline{|}{\IUsym{\{\}}}{}{}{}{\IUcom{top value}}\IUprodnewline
\IUprodline{|}{\IUkw{null}}{}{}{}{\IUcom{null value}}\IUprodnewline
\IUprodline{|}{ n }{}{}{}{\IUcom{integer literal}}\IUprodnewline
\IUprodline{|}{\IUmv{x}}{}{}{}{\IUcom{variable}}\IUprodnewline
\IUprodline{|}{ \lambda \IUmv{x} \!:\! \IUnt{A} .\; \IUnt{e} \!:\! \IUnt{B} }{}{}{}{\IUcom{abstraction}}\IUprodnewline
\IUprodline{|}{ \lambda \IUmv{x} \!:\! \IUnt{A} .\; \IUnt{e} } {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUnt{e_{{\mathrm{1}}}} \, \IUnt{e_{{\mathrm{2}}}}}{}{}{}{\IUcom{application}}\IUprodnewline
\IUprodline{|}{\IUsym{\{}  \ell  \IUsym{:}  \IUnt{A}  \IUsym{=}  \IUnt{e}  \IUsym{\}}}{}{}{}{\IUcom{record}}\IUprodnewline
\IUprodline{|}{\IUsym{\{}  \ell  \IUsym{=}  \IUnt{e}  \IUsym{\}}} {\textsf{S}}{}{}{\IUcom{record}}\IUprodnewline
\IUprodline{|}{\IUnt{e}  \IUsym{.}  \ell}{}{}{}{\IUcom{projection}}\IUprodnewline
\IUprodline{|}{\IUnt{e_{{\mathrm{1}}}}  \bbcomma  \IUnt{e_{{\mathrm{2}}}}}{}{}{}{\IUcom{merging}}\IUprodnewline
\IUprodline{|}{\IUkw{switch} \, \IUnt{e_{{\mathrm{0}}}} \, \IUkw{as} \, \IUmv{x} \, \IUkw{case} \, \IUnt{A}  \Rightarrow  \IUnt{e_{{\mathrm{1}}}} \, \IUkw{case} \, \IUnt{B}  \Rightarrow  \IUnt{e_{{\mathrm{2}}}}}{}{}{}{\IUcom{type switch}}\IUprodnewline
\IUprodline{|}{\IUkw{switch} \, \IUnt{e_{{\mathrm{0}}}} \, \IUkw{case} \, \IUnt{A}  \Rightarrow  \IUnt{e_{{\mathrm{1}}}} \, \IUkw{case} \, \IUnt{B}  \Rightarrow  \IUnt{e_{{\mathrm{2}}}}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUnt{letin} \, \IUnt{e}}{}{}{}{}\IUprodnewline
\IUprodline{|}{\IUsym{(}  \IUnt{e}  \IUsym{)}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUsym{0}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUsym{1}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUsym{2}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUnt{e_{{\mathrm{1}}}}  \IUsym{+}  \IUnt{e_{{\mathrm{2}}}}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{ [\,] } {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUsym{[0]}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{  } {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUnt{E}  \IUsym{[}  \IUnt{e}  \IUsym{]}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{ [  \IUnt{v} \IUsym{/} \IUmv{x}  ]\, \IUnt{e} } {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{ \IUnt{e} : \IUnt{A} } {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{ \ldots } {\textsf{S}}{}{}{}}

\newcommand{\IUval}{
\IUrulehead{\IUnt{val}  ,\ \IUnt{v}}{::=}{\IUcom{values}}\IUprodnewline
\IUfirstprodline{|}{\IUsym{\{\}}}{}{}{}{}\IUprodnewline
\IUprodline{|}{\IUkw{null}}{}{}{}{}\IUprodnewline
\IUprodline{|}{ n }{}{}{}{}\IUprodnewline
\IUprodline{|}{ \lambda \IUmv{x} \!:\! \IUnt{A} .\; \IUnt{e} \!:\! \IUnt{B} }{}{}{}{}\IUprodnewline
\IUprodline{|}{\IUsym{\{}  \ell  \IUsym{:}  \IUnt{A}  \IUsym{=}  \IUnt{v}  \IUsym{\}}}{}{}{}{}\IUprodnewline
\IUprodline{|}{\IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}}{}{}{}{}\IUprodnewline
\IUprodline{|}{ \ldots }{}{}{}{}}

\newcommand{\IUletin}{
\IUrulehead{\IUnt{letin}}{::=}{\IUcom{let-in bindings}}\IUprodnewline
\IUfirstprodline{|}{\IUkw{id}}{}{}{}{}\IUprodnewline
\IUprodline{|}{ \IUnt{letin} \circ \IUnt{letin'} }{}{}{}{}\IUprodnewline
\IUprodline{|}{\IUkw{let} \, \IUmv{x}  \IUsym{=}  \IUnt{e} \, \IUkw{in}}{}{}{}{}}

\newcommand{\IUctx}{
\IUrulehead{\IUnt{ctx}  ,\ \Gamma}{::=}{\IUcom{typing context}}\IUprodnewline
\IUfirstprodline{|}{ \cdot }{}{}{}{}\IUprodnewline
\IUprodline{|}{\Gamma  ,\,  \IUmv{x}  \IUsym{:}  \IUnt{A}}{}{}{}{}}

\newcommand{\IUstyp}{
\IUrulehead{\IUnt{styp}  ,\ \mathcal{A}  ,\ \mathcal{B}}{::=}{\IUcom{source types}}\IUprodnewline
\IUfirstprodline{|}{ \mathbb{Z} }{}{}{}{\IUcom{integer type}}\IUprodnewline
\IUprodline{|}{ ( \mathcal{A} ) \rightarrow \mathcal{B} }{}{}{}{\IUcom{function type}}\IUprodnewline
\IUprodline{|}{\IUsym{\{}  \mathcal{P}  \IUsym{\}}  \rightarrow  \mathcal{B}}{}{}{}{\IUcom{function type with named parameters}}\IUprodnewline
\IUprodline{|}{\IUsym{\{}  \mathcal{K}  \IUsym{\}}}{}{}{}{\IUcom{named argument type}}\IUprodnewline
\IUprodline{|}{\IUsym{(}  \mathcal{A}  \IUsym{)}} {\textsf{S}}{}{}{}}

\newcommand{\IUnptyp}{
\IUrulehead{\IUnt{nptyp}  ,\ \mathcal{P}}{::=}{\IUcom{named parameter types}}\IUprodnewline
\IUfirstprodline{|}{ \cdot }{}{}{}{\IUcom{empty}}\IUprodnewline
\IUprodline{|}{\mathcal{P}  ;\,  \ell  \IUsym{:}  \mathcal{A}}{}{}{}{\IUcom{required parameter}}\IUprodnewline
\IUprodline{|}{\mathcal{P}  ;\,  \ell  \IUsym{\mbox{?}}  \IUsym{:}  \mathcal{A}}{}{}{}{\IUcom{optional parameter}}\IUprodnewline
\IUprodline{|}{\IUsym{(}  \mathcal{P}  \IUsym{)}} {\textsf{S}}{}{}{}}

\newcommand{\IUnatyp}{
\IUrulehead{\IUnt{natyp}  ,\ \mathcal{K}}{::=}{\IUcom{named argument types}}\IUprodnewline
\IUfirstprodline{|}{ \cdot }{}{}{}{\IUcom{empty}}\IUprodnewline
\IUprodline{|}{\mathcal{K}  ;\,  \ell  \IUsym{:}  \mathcal{A}}{}{}{}{\IUcom{field}}\IUprodnewline
\IUprodline{|}{\IUsym{(}  \mathcal{K}  \IUsym{)}} {\textsf{S}}{}{}{}}

\newcommand{\IUsexp}{
\IUrulehead{\IUnt{sexp}  ,\ \epsilon}{::=}{\IUcom{source expressions}}\IUprodnewline
\IUfirstprodline{|}{ n }{}{}{}{\IUcom{integer literal}}\IUprodnewline
\IUprodline{|}{\IUmv{x}}{}{}{}{\IUcom{variable}}\IUprodnewline
\IUprodline{|}{ \lambda ( \IUmv{x} \!:\! \mathcal{A} ).\; \epsilon }{}{}{}{\IUcom{abstraction}}\IUprodnewline
\IUprodline{|}{ \lambda \{ \rho \}.\; \epsilon }{}{}{}{\IUcom{abstraction with named parameters}}\IUprodnewline
\IUprodline{|}{\epsilon_{{\mathrm{1}}} \, \epsilon_{{\mathrm{2}}}}{}{}{}{\IUcom{application}}\IUprodnewline
\IUprodline{|}{\IUsym{\{}  \kappa  \IUsym{\}}}{}{}{}{\IUcom{named arguments}}\IUprodnewline
\IUprodline{|}{\IUsym{(}  \epsilon  \IUsym{)}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUsym{0}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUsym{1}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\IUsym{2}} {\textsf{S}}{}{}{}\IUprodnewline
\IUprodline{|}{\epsilon_{{\mathrm{1}}}  \IUsym{+}  \epsilon_{{\mathrm{2}}}} {\textsf{S}}{}{}{}}

\newcommand{\IUnpexp}{
\IUrulehead{\IUnt{npexp}  ,\ \rho}{::=}{\IUcom{named parameters}}\IUprodnewline
\IUfirstprodline{|}{ \cdot }{}{}{}{\IUcom{empty}}\IUprodnewline
\IUprodline{|}{\rho  ;\,  \ell  \IUsym{:}  \mathcal{A}}{}{}{}{\IUcom{required parameter}}\IUprodnewline
\IUprodline{|}{\rho  ;\,  \ell  \IUsym{=}  \epsilon}{}{}{}{\IUcom{optional parameter}}\IUprodnewline
\IUprodline{|}{\IUsym{(}  \rho  \IUsym{)}} {\textsf{S}}{}{}{}}

\newcommand{\IUnaexp}{
\IUrulehead{\IUnt{naexp}  ,\ \kappa}{::=}{\IUcom{named arguments}}\IUprodnewline
\IUfirstprodline{|}{ \cdot }{}{}{}{\IUcom{empty}}\IUprodnewline
\IUprodline{|}{\kappa  ;\,  \ell  \IUsym{=}  \epsilon}{}{}{}{\IUcom{field}}\IUprodnewline
\IUprodline{|}{\IUsym{(}  \kappa  \IUsym{)}} {\textsf{S}}{}{}{}}

\newcommand{\IUsctx}{
\IUrulehead{\IUnt{sctx}  ,\ \Delta}{::=}{\IUcom{typing context}}\IUprodnewline
\IUfirstprodline{|}{ \cdot }{}{}{}{}\IUprodnewline
\IUprodline{|}{\Delta  ,\,  \IUmv{x}  \IUsym{:}  \mathcal{A}}{}{}{}{}}

\newcommand{\IUgrammar}{\IUgrammartabular{
\IUtyp\IUinterrule
\IUord\IUinterrule
\IUexp\IUinterrule
\IUval\IUinterrule
\IUletin\IUinterrule
\IUctx\IUinterrule
\IUstyp\IUinterrule
\IUnptyp\IUinterrule
\IUnatyp\IUinterrule
\IUsexp\IUinterrule
\IUnpexp\IUinterrule
\IUnaexp\IUinterrule
\IUsctx\IUafterlastrule
}}

% defnss
% fundefns Trans
% fundefn trans

\newcommand{\IUfundefntrans}[1]{\begin{IUfundefnblock}[#1]{$|  \mathcal{A}  |$}{\IUcom{Type translation}}
\IUfunclause{|   \mathbb{Z}   |}{ \mathbb{Z} }%
\IUfunclause{|   ( \mathcal{A} ) \rightarrow \mathcal{B}   |}{|  \mathcal{A}  |  \rightarrow  |  \mathcal{B}  |}%
\IUfunclause{|  \IUsym{\{}  \mathcal{P}  \IUsym{\}}  \rightarrow  \mathcal{B}  |}{|  \mathcal{P}  |  \rightarrow  |  \mathcal{B}  |}%
\IUfunclause{|  \IUsym{\{}  \mathcal{K}  \IUsym{\}}  |}{ | \mathcal{K} | }%
\end{IUfundefnblock}}


% fundefn ptrans

\newcommand{\IUfundefnptrans}[1]{\begin{IUfundefnblock}[#1]{$|  \mathcal{P}  |$}{\IUcom{Parameter type translation}}
\IUfunclause{|   \cdot   |}{ \top }%
\IUfunclause{|  \mathcal{P}  ;\,  \ell  \IUsym{:}  \mathcal{A}  |}{|  \mathcal{P}  |  \land  \IUsym{\{}  \ell  \IUsym{:}  |  \mathcal{A}  |  \IUsym{\}}}%
\IUfunclause{|  \mathcal{P}  ;\,  \ell  \IUsym{\mbox{?}}  \IUsym{:}  \mathcal{A}  |}{|  \mathcal{P}  |  \land  \IUsym{\{}  \ell  \IUsym{:}  |  \mathcal{A}  |  \lor  \IUkw{Null}  \IUsym{\}}}%
\end{IUfundefnblock}}


% fundefn atrans

\newcommand{\IUfundefnatrans}[1]{\begin{IUfundefnblock}[#1]{$ | \mathcal{K} | $}{\IUcom{Argument type translation}}
\IUfunclause{ |  \cdot  | }{ \top }%
\IUfunclause{ | \mathcal{K}  ;\,  \ell  \IUsym{:}  \mathcal{A} | }{ | \mathcal{K} |   \land  \IUsym{\{}  \ell  \IUsym{:}  |  \mathcal{A}  |  \IUsym{\}}}%
\end{IUfundefnblock}}


\newcommand{\IUfundefnsTrans}{
\IUfundefntrans{}
\IUfundefnptrans{}
\IUfundefnatrans{}}

% fundefns CtxTrans
% fundefn ctxtrans

\newcommand{\IUfundefnctxtrans}[1]{\begin{IUfundefnblock}[#1]{$|  \Delta  |$}{\IUcom{Typing context translation}}
\IUfunclause{|   \cdot   |}{ \cdot }%
\IUfunclause{|  \Delta  ,\,  \IUmv{x}  \IUsym{:}  \mathcal{A}  |}{|  \Delta  |  ,\,  \IUmv{x}  \IUsym{:}  |  \mathcal{A}  |}%
\end{IUfundefnblock}}


\newcommand{\IUfundefnsCtxTrans}{
\IUfundefnctxtrans{}}

% fundefns DynType
% fundefn dyntype

\newcommand{\IUfundefndyntype}[1]{\begin{IUfundefnblock}[#1]{$\lfloor  \IUnt{v}  \rfloor$}{}
\end{IUfundefnblock}}


% fundefn input

\newcommand{\IUfundefninput}[1]{\begin{IUfundefnblock}[#1]{$\lfloor  \IUnt{v}  \rfloor  ^\lambda$}{}
\end{IUfundefnblock}}


\newcommand{\IUfundefnsDynType}{
\IUfundefndyntype{}
\IUfundefninput{}}

% defns Target
%% defn sub
\newcommand{\IUdruleSubXXNull}[1]{\IUdrule[#1]{%
}{
\IUkw{Null}  \IUsym{<:}  \IUkw{Null}}{%
{\IUdrulename{Sub\_Null}}{}%
}}


\newcommand{\IUdruleSubXXInt}[1]{\IUdrule[#1]{%
}{
 \mathbb{Z}   \IUsym{<:}   \mathbb{Z} }{%
{\IUdrulename{Sub\_Int}}{}%
}}


\newcommand{\IUdruleSubXXArrow}[1]{\IUdrule[#1]{%
\IUpremise{\IUnt{A_{{\mathrm{2}}}}  \IUsym{<:}  \IUnt{A_{{\mathrm{1}}}}}%
\IUpremise{\IUnt{B_{{\mathrm{1}}}}  \IUsym{<:}  \IUnt{B_{{\mathrm{2}}}}}%
}{
\IUnt{A_{{\mathrm{1}}}}  \rightarrow  \IUnt{B_{{\mathrm{1}}}}  \IUsym{<:}  \IUnt{A_{{\mathrm{2}}}}  \rightarrow  \IUnt{B_{{\mathrm{2}}}}}{%
{\IUdrulename{Sub\_Arrow}}{}%
}}


\newcommand{\IUdruleSubXXRcd}[1]{\IUdrule[#1]{%
\IUpremise{\IUnt{A}  \IUsym{<:}  \IUnt{B}}%
}{
\IUsym{\{}  \ell  \IUsym{:}  \IUnt{A}  \IUsym{\}}  \IUsym{<:}  \IUsym{\{}  \ell  \IUsym{:}  \IUnt{B}  \IUsym{\}}}{%
{\IUdrulename{Sub\_Rcd}}{}%
}}


\newcommand{\IUdruleSubXXAnd}[1]{\IUdrule[#1]{%
\IUpremise{\IUnt{A}  \IUsym{<:}  \IUnt{B}}%
\IUpremise{\IUnt{A}  \IUsym{<:}  \IUnt{C}}%
}{
\IUnt{A}  \IUsym{<:}  \IUnt{B}  \land  \IUnt{C}}{%
{\IUdrulename{Sub\_And}}{}%
}}


\newcommand{\IUdruleSubXXAndL}[1]{\IUdrule[#1]{%
\IUpremise{\IUnt{A}  \IUsym{<:}  \IUnt{C}}%
}{
\IUnt{A}  \land  \IUnt{B}  \IUsym{<:}  \IUnt{C}}{%
{\IUdrulename{Sub\_AndL}}{}%
}}


\newcommand{\IUdruleSubXXAndR}[1]{\IUdrule[#1]{%
\IUpremise{\IUnt{B}  \IUsym{<:}  \IUnt{C}}%
}{
\IUnt{A}  \land  \IUnt{B}  \IUsym{<:}  \IUnt{C}}{%
{\IUdrulename{Sub\_AndR}}{}%
}}


\newcommand{\IUdruleSubXXOr}[1]{\IUdrule[#1]{%
\IUpremise{\IUnt{A}  \IUsym{<:}  \IUnt{C}}%
\IUpremise{\IUnt{B}  \IUsym{<:}  \IUnt{C}}%
}{
\IUnt{A}  \lor  \IUnt{B}  \IUsym{<:}  \IUnt{C}}{%
{\IUdrulename{Sub\_Or}}{}%
}}


\newcommand{\IUdruleSubXXOrL}[1]{\IUdrule[#1]{%
\IUpremise{\IUnt{A}  \IUsym{<:}  \IUnt{B}}%
}{
\IUnt{A}  \IUsym{<:}  \IUnt{B}  \lor  \IUnt{C}}{%
{\IUdrulename{Sub\_OrL}}{}%
}}


\newcommand{\IUdruleSubXXOrR}[1]{\IUdrule[#1]{%
\IUpremise{\IUnt{A}  \IUsym{<:}  \IUnt{C}}%
}{
\IUnt{A}  \IUsym{<:}  \IUnt{B}  \lor  \IUnt{C}}{%
{\IUdrulename{Sub\_OrR}}{}%
}}


\newcommand{\IUdruleSubXXTop}[1]{\IUdrule[#1]{%
}{
\IUnt{A}  \IUsym{<:}   \top }{%
{\IUdrulename{Sub\_Top}}{}%
}}


\newcommand{\IUdruleSubXXBot}[1]{\IUdrule[#1]{%
}{
 \bot   \IUsym{<:}  \IUnt{A}}{%
{\IUdrulename{Sub\_Bot}}{}%
}}

\newcommand{\IUdefnsub}[1]{\begin{IUdefnblock}[#1]{$\IUnt{A}  \IUsym{<:}  \IUnt{B}$}{\IUcom{Subtyping}}
\IUusedrule{\IUdruleSubXXNull{}}
\IUusedrule{\IUdruleSubXXInt{}}
\IUusedrule{\IUdruleSubXXArrow{}}
\IUusedrule{\IUdruleSubXXRcd{}}
\IUusedrule{\IUdruleSubXXAnd{}}
\IUusedrule{\IUdruleSubXXAndL{}}
\IUusedrule{\IUdruleSubXXAndR{}}
\IUusedrule{\IUdruleSubXXOr{}}
\IUusedrule{\IUdruleSubXXOrL{}}
\IUusedrule{\IUdruleSubXXOrR{}}
\IUusedrule{\IUdruleSubXXTop{}}
\IUusedrule{\IUdruleSubXXBot{}}
\end{IUdefnblock}}

%% defn typing
\newcommand{\IUdruleTypXXTop}[1]{\IUdrule[#1]{%
}{
\Gamma  \,\vdash\,  \IUsym{\{\}}  \IUsym{:}   \top }{%
{\IUdrulename{Typ\_Top}}{}%
}}


\newcommand{\IUdruleTypXXNull}[1]{\IUdrule[#1]{%
}{
\Gamma  \,\vdash\,  \IUkw{null}  \IUsym{:}  \IUkw{Null}}{%
{\IUdrulename{Typ\_Null}}{}%
}}


\newcommand{\IUdruleTypXXInt}[1]{\IUdrule[#1]{%
}{
\Gamma  \,\vdash\,   n   \IUsym{:}   \mathbb{Z} }{%
{\IUdrulename{Typ\_Int}}{}%
}}


\newcommand{\IUdruleTypXXVar}[1]{\IUdrule[#1]{%
\IUpremise{ \IUmv{x} \IUsym{:} \IUnt{A} \in \Gamma }%
}{
\Gamma  \,\vdash\,  \IUmv{x}  \IUsym{:}  \IUnt{A}}{%
{\IUdrulename{Typ\_Var}}{}%
}}


\newcommand{\IUdruleTypXXAbs}[1]{\IUdrule[#1]{%
\IUpremise{\Gamma  ,\,  \IUmv{x}  \IUsym{:}  \IUnt{A}  \,\vdash\,  \IUnt{e}  \IUsym{:}  \IUnt{B}}%
}{
\Gamma  \,\vdash\,  \IUsym{(}   \lambda \IUmv{x} \!:\! \IUnt{A} .\; \IUnt{e} \!:\! \IUnt{B}   \IUsym{)}  \IUsym{:}  \IUnt{A}  \rightarrow  \IUnt{B}}{%
{\IUdrulename{Typ\_Abs}}{}%
}}


\newcommand{\IUdruleTypXXApp}[1]{\IUdrule[#1]{%
\IUpremise{\Gamma  \,\vdash\,  \IUnt{e_{{\mathrm{1}}}}  \IUsym{:}  \IUnt{A}  \rightarrow  \IUnt{B}}%
\IUpremise{\Gamma  \,\vdash\,  \IUnt{e_{{\mathrm{2}}}}  \IUsym{:}  \IUnt{A}}%
}{
\Gamma  \,\vdash\,  \IUnt{e_{{\mathrm{1}}}} \, \IUnt{e_{{\mathrm{2}}}}  \IUsym{:}  \IUnt{B}}{%
{\IUdrulename{Typ\_App}}{}%
}}


\newcommand{\IUdruleTypXXRcd}[1]{\IUdrule[#1]{%
\IUpremise{\Gamma  \,\vdash\,  \IUnt{e}  \IUsym{:}  \IUnt{A}}%
}{
\Gamma  \,\vdash\,  \IUsym{\{}  \ell  \IUsym{:}  \IUnt{A}  \IUsym{=}  \IUnt{e}  \IUsym{\}}  \IUsym{:}  \IUsym{\{}  \ell  \IUsym{:}  \IUnt{A}  \IUsym{\}}}{%
{\IUdrulename{Typ\_Rcd}}{}%
}}


\newcommand{\IUdruleTypXXPrj}[1]{\IUdrule[#1]{%
\IUpremise{\Gamma  \,\vdash\,  \IUnt{e}  \IUsym{:}  \IUsym{\{}  \ell  \IUsym{:}  \IUnt{A}  \IUsym{\}}}%
}{
\Gamma  \,\vdash\,  \IUnt{e}  \IUsym{.}  \ell  \IUsym{:}  \IUnt{A}}{%
{\IUdrulename{Typ\_Prj}}{}%
}}


\newcommand{\IUdruleTypXXLet}[1]{\IUdrule[#1]{%
\IUpremise{\Gamma  \,\vdash\,  \IUnt{letin}  \,\dashv\,  \Gamma'}%
\IUpremise{\Gamma'  \,\vdash\,  \IUnt{e}  \IUsym{:}  \IUnt{A}}%
}{
\Gamma  \,\vdash\,  \IUnt{letin} \, \IUnt{e}  \IUsym{:}  \IUnt{A}}{%
{\IUdrulename{Typ\_Let}}{}%
}}


\newcommand{\IUdruleTypXXMerge}[1]{\IUdrule[#1]{%
\IUpremise{\Gamma  \,\vdash\,  \IUnt{e_{{\mathrm{1}}}}  \IUsym{:}  \IUnt{A}}%
\IUpremise{\Gamma  \,\vdash\,  \IUnt{e_{{\mathrm{2}}}}  \IUsym{:}  \IUnt{B}}%
}{
\Gamma  \,\vdash\,  \IUnt{e_{{\mathrm{1}}}}  \bbcomma  \IUnt{e_{{\mathrm{2}}}}  \IUsym{:}  \IUnt{A}  \land  \IUnt{B}}{%
{\IUdrulename{Typ\_Merge}}{}%
}}


\newcommand{\IUdruleTypXXSwitch}[1]{\IUdrule[#1]{%
\IUpremise{\Gamma  \,\vdash\,  \IUnt{e_{{\mathrm{0}}}}  \IUsym{:}  \IUnt{A}  \lor  \IUnt{B}}%
\IUpremise{\Gamma  ,\,  \IUmv{x}  \IUsym{:}  \IUnt{A}  \,\vdash\,  \IUnt{e_{{\mathrm{1}}}}  \IUsym{:}  \IUnt{C}}%
\IUpremise{\Gamma  ,\,  \IUmv{x}  \IUsym{:}  \IUnt{B}  \,\vdash\,  \IUnt{e_{{\mathrm{2}}}}  \IUsym{:}  \IUnt{C}}%
}{
\Gamma  \,\vdash\,  \IUkw{switch} \, \IUnt{e_{{\mathrm{0}}}} \, \IUkw{as} \, \IUmv{x} \, \IUkw{case} \, \IUnt{A}  \Rightarrow  \IUnt{e_{{\mathrm{1}}}} \, \IUkw{case} \, \IUnt{B}  \Rightarrow  \IUnt{e_{{\mathrm{2}}}}  \IUsym{:}  \IUnt{C}}{%
{\IUdrulename{Typ\_Switch}}{}%
}}


\newcommand{\IUdruleTypXXSub}[1]{\IUdrule[#1]{%
\IUpremise{\Gamma  \,\vdash\,  \IUnt{e}  \IUsym{:}  \IUnt{A}}%
\IUpremise{\IUnt{A}  \IUsym{<:}  \IUnt{B}}%
}{
\Gamma  \,\vdash\,  \IUnt{e}  \IUsym{:}  \IUnt{B}}{%
{\IUdrulename{Typ\_Sub}}{}%
}}

\newcommand{\IUdefntyping}[1]{\begin{IUdefnblock}[#1]{$\Gamma  \,\vdash\,  \IUnt{e}  \IUsym{:}  \IUnt{A}$}{\IUcom{Typing}}
\IUusedrule{\IUdruleTypXXTop{}}
\IUusedrule{\IUdruleTypXXNull{}}
\IUusedrule{\IUdruleTypXXInt{}}
\IUusedrule{\IUdruleTypXXVar{}}
\IUusedrule{\IUdruleTypXXAbs{}}
\IUusedrule{\IUdruleTypXXApp{}}
\IUusedrule{\IUdruleTypXXRcd{}}
\IUusedrule{\IUdruleTypXXPrj{}}
\IUusedrule{\IUdruleTypXXLet{}}
\IUusedrule{\IUdruleTypXXMerge{}}
\IUusedrule{\IUdruleTypXXSwitch{}}
\IUusedrule{\IUdruleTypXXSub{}}
\end{IUdefnblock}}

%% defn letbind
\newcommand{\IUdruleLBXXLet}[1]{\IUdrule[#1]{%
\IUpremise{\Gamma  \,\vdash\,  \IUnt{e}  \IUsym{:}  \IUnt{A}}%
}{
\Gamma  \,\vdash\,  \IUkw{let} \, \IUmv{x}  \IUsym{=}  \IUnt{e} \, \IUkw{in}  \,\dashv\,  \Gamma  ,\,  \IUmv{x}  \IUsym{:}  \IUnt{A}}{%
{\IUdrulename{LB\_Let}}{}%
}}


\newcommand{\IUdruleLBXXComp}[1]{\IUdrule[#1]{%
\IUpremise{\Gamma  \,\vdash\,  \IUnt{letin_{{\mathrm{1}}}}  \,\dashv\,  \Gamma'}%
\IUpremise{\Gamma'  \,\vdash\,  \IUnt{letin_{{\mathrm{2}}}}  \,\dashv\,  \Gamma''}%
}{
\Gamma  \,\vdash\,   \IUnt{letin_{{\mathrm{1}}}} \circ \IUnt{letin_{{\mathrm{2}}}}   \,\dashv\,  \Gamma''}{%
{\IUdrulename{LB\_Comp}}{}%
}}


\newcommand{\IUdruleLBXXId}[1]{\IUdrule[#1]{%
}{
\Gamma  \,\vdash\,  \IUkw{id}  \,\dashv\,  \Gamma}{%
{\IUdrulename{LB\_Id}}{}%
}}

\newcommand{\IUdefnletbind}[1]{\begin{IUdefnblock}[#1]{$\Gamma  \,\vdash\,  \IUnt{letin}  \,\dashv\,  \Gamma'$}{\IUcom{Let-in binding}}
\IUusedrule{\IUdruleLBXXLet{}}
\IUusedrule{\IUdruleLBXXComp{}}
\IUusedrule{\IUdruleLBXXId{}}
\end{IUdefnblock}}


\newcommand{\IUdefnsTarget}{
\IUdefnsub{}\IUdefntyping{}\IUdefnletbind{}}

% defns Semantics
%% defn step
\newcommand{\IUdruleStepXXApp}[1]{\IUdrule[#1]{%
\IUpremise{ \IUnt{v} \, \longrightarrow _{ \IUnt{A} }\, \IUnt{v'} }%
}{
\IUsym{(}   \lambda \IUmv{x} \!:\! \IUnt{A} .\; \IUnt{e} \!:\! \IUnt{B}   \IUsym{)} \, \IUnt{v}  \longrightarrow   \IUsym{(}   [  \IUnt{v'} \IUsym{/} \IUmv{x}  ]\, \IUnt{e}   \IUsym{)} : \IUnt{B} }{%
{\IUdrulename{Step\_App}}{}%
}}


\newcommand{\IUdruleStepXXPrj}[1]{\IUdrule[#1]{%
\IUpremise{ \IUnt{v} \, \longrightarrow _{ \IUnt{A} }\, \IUnt{v'} }%
}{
\IUsym{\{}  \ell  \IUsym{:}  \IUnt{A}  \IUsym{=}  \IUnt{v}  \IUsym{\}}  \IUsym{.}  \ell  \longrightarrow  \IUnt{v'}}{%
{\IUdrulename{Step\_Prj}}{}%
}}


\newcommand{\IUdruleStepXXAppDispatch}[1]{\IUdrule[#1]{%
\IUpremise{\IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \;\bullet\;  \IUnt{v}  \longrightarrow  \IUnt{e'}}%
}{
\IUsym{(}  \IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \IUsym{)} \, \IUnt{v}  \longrightarrow  \IUnt{e'}}{%
{\IUdrulename{Step\_AppDispatch}}{}%
}}


\newcommand{\IUdruleStepXXPrjDispatch}[1]{\IUdrule[#1]{%
\IUpremise{\IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \;\bullet\;  \ell  \longrightarrow  \IUnt{e'}}%
}{
\IUsym{(}  \IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \IUsym{)}  \IUsym{.}  \ell  \longrightarrow  \IUnt{e'}}{%
{\IUdrulename{Step\_PrjDispatch}}{}%
}}


\newcommand{\IUdruleStepXXSwitchL}[1]{\IUdrule[#1]{%
\IUpremise{ \IUnt{v} \, \longrightarrow _{ \IUnt{A} }\, \IUnt{v'} }%
}{
\IUkw{switch} \, \IUnt{v} \, \IUkw{as} \, \IUmv{x} \, \IUkw{case} \, \IUnt{A}  \Rightarrow  \IUnt{e_{{\mathrm{1}}}} \, \IUkw{case} \, \IUnt{B}  \Rightarrow  \IUnt{e_{{\mathrm{2}}}}  \longrightarrow   [  \IUnt{v'} \IUsym{/} \IUmv{x}  ]\, \IUnt{e_{{\mathrm{1}}}} }{%
{\IUdrulename{Step\_SwitchL}}{}%
}}


\newcommand{\IUdruleStepXXAnno}[1]{\IUdrule[#1]{%
\IUpremise{ \IUnt{v} \, \longrightarrow _{ \IUnt{A} }\, \IUnt{v'} }%
}{
 \IUnt{v} : \IUnt{A}   \longrightarrow  \IUnt{v'}}{%
{\IUdrulename{Step\_Anno}}{}%
}}


\newcommand{\IUdruleStepXXSwitchR}[1]{\IUdrule[#1]{%
\IUpremise{ \IUnt{v} \, \longrightarrow _{ \IUnt{B} }\, \IUnt{v'} }%
}{
\IUkw{switch} \, \IUnt{v} \, \IUkw{as} \, \IUmv{x} \, \IUkw{case} \, \IUnt{A}  \Rightarrow  \IUnt{e_{{\mathrm{1}}}} \, \IUkw{case} \, \IUnt{B}  \Rightarrow  \IUnt{e_{{\mathrm{2}}}}  \longrightarrow   [  \IUnt{v'} \IUsym{/} \IUmv{x}  ]\, \IUnt{e_{{\mathrm{2}}}} }{%
{\IUdrulename{Step\_SwitchR}}{}%
}}


\newcommand{\IUdruleStepXXCtx}[1]{\IUdrule[#1]{%
\IUpremise{\IUnt{e}  \longrightarrow  \IUnt{e'}}%
}{
\IUnt{E}  \IUsym{[}  \IUnt{e}  \IUsym{]}  \longrightarrow  \IUnt{E}  \IUsym{[}  \IUnt{e'}  \IUsym{]}}{%
{\IUdrulename{Step\_Ctx}}{}%
}}

\newcommand{\IUdefnstep}[1]{\begin{IUdefnblock}[#1]{$\IUnt{e}  \longrightarrow  \IUnt{e'}$}{\IUcom{Small-step operational semantics}}
\IUusedrule{\IUdruleStepXXApp{}}
\IUusedrule{\IUdruleStepXXPrj{}}
\IUusedrule{\IUdruleStepXXAppDispatch{}}
\IUusedrule{\IUdruleStepXXPrjDispatch{}}
\IUusedrule{\IUdruleStepXXSwitchL{}}
\IUusedrule{\IUdruleStepXXAnno{}}
\IUusedrule{\IUdruleStepXXSwitchR{}}
\IUusedrule{\IUdruleStepXXCtx{}}
\end{IUdefnblock}}

%% defn cast
\newcommand{\IUdruleCastXXTop}[1]{\IUdrule[#1]{%
}{
 \IUnt{v} \, \longrightarrow _{  \top  }\, \IUsym{\{\}} }{%
{\IUdrulename{Cast\_Top}}{}%
}}


\newcommand{\IUdruleCastXXNull}[1]{\IUdrule[#1]{%
}{
 \IUkw{null} \, \longrightarrow _{ \IUkw{Null} }\, \IUkw{null} }{%
{\IUdrulename{Cast\_Null}}{}%
}}


\newcommand{\IUdruleCastXXInt}[1]{\IUdrule[#1]{%
}{
  n  \, \longrightarrow _{  \mathbb{Z}  }\,  n  }{%
{\IUdrulename{Cast\_Int}}{}%
}}


\newcommand{\IUdruleCastXXArrow}[1]{\IUdrule[#1]{%
\IUpremise{\IUnt{A_{{\mathrm{1}}}}  \rightarrow  \IUnt{B_{{\mathrm{1}}}}  \IUsym{<:}  \IUnt{A_{{\mathrm{2}}}}  \rightarrow  \IUnt{B_{{\mathrm{2}}}}}%
}{
  \lambda \IUmv{x} \!:\! \IUnt{A_{{\mathrm{1}}}} .\; \IUnt{e} \!:\! \IUnt{B_{{\mathrm{1}}}}  \, \longrightarrow _{ \IUnt{A_{{\mathrm{2}}}}  \rightarrow  \IUnt{B_{{\mathrm{2}}}} }\,  \lambda \IUmv{x} \!:\! \IUnt{A_{{\mathrm{1}}}} .\; \IUnt{e} \!:\! \IUnt{B_{{\mathrm{2}}}}  }{%
{\IUdrulename{Cast\_Arrow}}{}%
}}


\newcommand{\IUdruleCastXXRcd}[1]{\IUdrule[#1]{%
\IUpremise{\IUsym{\{}  \ell  \IUsym{:}  \IUnt{A}  \IUsym{\}}  \IUsym{<:}  \IUsym{\{}  \ell  \IUsym{:}  \IUnt{B}  \IUsym{\}}}%
}{
 \IUsym{\{}  \ell  \IUsym{:}  \IUnt{A}  \IUsym{=}  \IUnt{v}  \IUsym{\}} \, \longrightarrow _{ \IUsym{\{}  \ell  \IUsym{:}  \IUnt{B}  \IUsym{\}} }\, \IUsym{\{}  \ell  \IUsym{:}  \IUnt{B}  \IUsym{=}  \IUnt{v}  \IUsym{\}} }{%
{\IUdrulename{Cast\_Rcd}}{}%
}}


\newcommand{\IUdruleCastXXMerge}[1]{\IUdrule[#1]{%
\IUpremise{ \IUnt{v} \, \longrightarrow _{ \IUnt{A} }\, \IUnt{v_{{\mathrm{1}}}} }%
\IUpremise{ \IUnt{v} \, \longrightarrow _{ \IUnt{B} }\, \IUnt{v_{{\mathrm{2}}}} }%
}{
 \IUnt{v} \, \longrightarrow _{ \IUnt{A}  \land  \IUnt{B} }\, \IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}} }{%
{\IUdrulename{Cast\_Merge}}{}%
}}


\newcommand{\IUdruleCastXXMergeL}[1]{\IUdrule[#1]{%
\IUpremise{ \IUnt{v_{{\mathrm{1}}}} \, \longrightarrow _{ A^\circ }\, \IUnt{v'_{{\mathrm{1}}}} }%
}{
 \IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}} \, \longrightarrow _{ A^\circ }\, \IUnt{v'_{{\mathrm{1}}}} }{%
{\IUdrulename{Cast\_MergeL}}{}%
}}


\newcommand{\IUdruleCastXXMergeR}[1]{\IUdrule[#1]{%
\IUpremise{ \IUnt{v_{{\mathrm{2}}}} \, \longrightarrow _{ B^\circ }\, \IUnt{v'_{{\mathrm{2}}}} }%
}{
 \IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}} \, \longrightarrow _{ B^\circ }\, \IUnt{v'_{{\mathrm{2}}}} }{%
{\IUdrulename{Cast\_MergeR}}{}%
}}


\newcommand{\IUdruleCastXXOrL}[1]{\IUdrule[#1]{%
\IUpremise{ \IUnt{v} \, \longrightarrow _{ \IUnt{A} }\, \IUnt{v'} }%
}{
 \IUnt{v} \, \longrightarrow _{ \IUnt{A}  \lor  \IUnt{B} }\, \IUnt{v'} }{%
{\IUdrulename{Cast\_OrL}}{}%
}}


\newcommand{\IUdruleCastXXOrR}[1]{\IUdrule[#1]{%
\IUpremise{ \IUnt{v} \, \longrightarrow _{ \IUnt{B} }\, \IUnt{v'} }%
}{
 \IUnt{v} \, \longrightarrow _{ \IUnt{A}  \lor  \IUnt{B} }\, \IUnt{v'} }{%
{\IUdrulename{Cast\_OrR}}{}%
}}

\newcommand{\IUdefncast}[1]{\begin{IUdefnblock}[#1]{$ \IUnt{v} \, \longrightarrow _{ \IUnt{A} }\, \IUnt{v'} $}{\IUcom{Type casting}}
\IUusedrule{\IUdruleCastXXTop{}}
\IUusedrule{\IUdruleCastXXNull{}}
\IUusedrule{\IUdruleCastXXInt{}}
\IUusedrule{\IUdruleCastXXArrow{}}
\IUusedrule{\IUdruleCastXXRcd{}}
\IUusedrule{\IUdruleCastXXMerge{}}
\IUusedrule{\IUdruleCastXXMergeL{}}
\IUusedrule{\IUdruleCastXXMergeR{}}
\IUusedrule{\IUdruleCastXXOrL{}}
\IUusedrule{\IUdruleCastXXOrR{}}
\end{IUdefnblock}}

%% defn app
\newcommand{\IUdruleADXXLeft}[1]{\IUdrule[#1]{%
\IUpremise{\lfloor  \IUnt{v}  \rfloor  \IUsym{<:}  \lfloor  \IUnt{v_{{\mathrm{1}}}}  \rfloor  ^\lambda}%
\IUpremise{ \neg ( \lfloor  \IUnt{v}  \rfloor  \IUsym{<:}  \lfloor  \IUnt{v_{{\mathrm{2}}}}  \rfloor  ^\lambda ) }%
}{
\IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \;\bullet\;  \IUnt{v}  \longrightarrow  \IUnt{v_{{\mathrm{1}}}} \, \IUnt{v}}{%
{\IUdrulename{AD\_Left}}{}%
}}


\newcommand{\IUdruleADXXRight}[1]{\IUdrule[#1]{%
\IUpremise{\lfloor  \IUnt{v}  \rfloor  \IUsym{<:}  \lfloor  \IUnt{v_{{\mathrm{2}}}}  \rfloor  ^\lambda}%
\IUpremise{ \neg ( \lfloor  \IUnt{v}  \rfloor  \IUsym{<:}  \lfloor  \IUnt{v_{{\mathrm{1}}}}  \rfloor  ^\lambda ) }%
}{
\IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \;\bullet\;  \IUnt{v}  \longrightarrow  \IUnt{v_{{\mathrm{2}}}} \, \IUnt{v}}{%
{\IUdrulename{AD\_Right}}{}%
}}


\newcommand{\IUdruleADXXBoth}[1]{\IUdrule[#1]{%
\IUpremise{\lfloor  \IUnt{v}  \rfloor  \IUsym{<:}  \lfloor  \IUnt{v_{{\mathrm{1}}}}  \rfloor  ^\lambda}%
\IUpremise{\lfloor  \IUnt{v}  \rfloor  \IUsym{<:}  \lfloor  \IUnt{v_{{\mathrm{2}}}}  \rfloor  ^\lambda}%
}{
\IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \;\bullet\;  \IUnt{v}  \longrightarrow  \IUnt{v_{{\mathrm{1}}}} \, \IUnt{v}  \bbcomma  \IUnt{v_{{\mathrm{2}}}} \, \IUnt{v}}{%
{\IUdrulename{AD\_Both}}{}%
}}

\newcommand{\IUdefnapp}[1]{\begin{IUdefnblock}[#1]{$\IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \;\bullet\;  \IUnt{v}  \longrightarrow  \IUnt{e}$}{\IUcom{Applicative dispatch}}
\IUusedrule{\IUdruleADXXLeft{}}
\IUusedrule{\IUdruleADXXRight{}}
\IUusedrule{\IUdruleADXXBoth{}}
\end{IUdefnblock}}

%% defn prj
\newcommand{\IUdrulePDXXLeft}[1]{\IUdrule[#1]{%
\IUpremise{\lfloor  \IUnt{v_{{\mathrm{1}}}}  \rfloor  \IUsym{<:}  \IUsym{\{}  \ell  \IUsym{:}   \top   \IUsym{\}}}%
\IUpremise{ \neg ( \lfloor  \IUnt{v_{{\mathrm{2}}}}  \rfloor  \IUsym{<:}  \IUsym{\{}  \ell  \IUsym{:}   \top   \IUsym{\}} ) }%
}{
\IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \;\bullet\;  \ell  \longrightarrow  \IUnt{v_{{\mathrm{1}}}}  \IUsym{.}  \ell}{%
{\IUdrulename{PD\_Left}}{}%
}}


\newcommand{\IUdrulePDXXRight}[1]{\IUdrule[#1]{%
\IUpremise{\lfloor  \IUnt{v_{{\mathrm{2}}}}  \rfloor  \IUsym{<:}  \IUsym{\{}  \ell  \IUsym{:}   \top   \IUsym{\}}}%
\IUpremise{ \neg ( \lfloor  \IUnt{v_{{\mathrm{1}}}}  \rfloor  \IUsym{<:}  \IUsym{\{}  \ell  \IUsym{:}   \top   \IUsym{\}} ) }%
}{
\IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \;\bullet\;  \ell  \longrightarrow  \IUnt{v_{{\mathrm{2}}}}  \IUsym{.}  \ell}{%
{\IUdrulename{PD\_Right}}{}%
}}


\newcommand{\IUdrulePDXXBoth}[1]{\IUdrule[#1]{%
\IUpremise{\lfloor  \IUnt{v_{{\mathrm{1}}}}  \rfloor  \IUsym{<:}  \IUsym{\{}  \ell  \IUsym{:}   \top   \IUsym{\}}}%
\IUpremise{\lfloor  \IUnt{v_{{\mathrm{2}}}}  \rfloor  \IUsym{<:}  \IUsym{\{}  \ell  \IUsym{:}   \top   \IUsym{\}}}%
}{
\IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \;\bullet\;  \ell  \longrightarrow  \IUnt{v_{{\mathrm{1}}}}  \IUsym{.}  \ell  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \IUsym{.}  \ell}{%
{\IUdrulename{PD\_Both}}{}%
}}

\newcommand{\IUdefnprj}[1]{\begin{IUdefnblock}[#1]{$\IUnt{v_{{\mathrm{1}}}}  \bbcomma  \IUnt{v_{{\mathrm{2}}}}  \;\bullet\;  \ell  \longrightarrow  \IUnt{e}$}{\IUcom{Projective dispatch}}
\IUusedrule{\IUdrulePDXXLeft{}}
\IUusedrule{\IUdrulePDXXRight{}}
\IUusedrule{\IUdrulePDXXBoth{}}
\end{IUdefnblock}}


\newcommand{\IUdefnsSemantics}{
\IUdefnstep{}\IUdefncast{}\IUdefnapp{}\IUdefnprj{}}

% defns Source
%% defn elab
\newcommand{\IUdruleElaXXInt}[1]{\IUdrule[#1]{%
}{
\Delta  \,\vdash\,   n   \IUsym{:}   \mathbb{Z}   \,\rightsquigarrow\,   n }{%
{\IUdrulename{Ela\_Int}}{}%
}}


\newcommand{\IUdruleElaXXVar}[1]{\IUdrule[#1]{%
\IUpremise{ \IUmv{x} \IUsym{:} \mathcal{A} \in \Delta }%
}{
\Delta  \,\vdash\,  \IUmv{x}  \IUsym{:}  \mathcal{A}  \,\rightsquigarrow\,  \IUmv{x}}{%
{\IUdrulename{Ela\_Var}}{}%
}}


\newcommand{\IUdruleElaXXAbs}[1]{\IUdrule[#1]{%
\IUpremise{\Delta  ,\,  \IUmv{x}  \IUsym{:}  \mathcal{A}  \,\vdash\,  \epsilon  \IUsym{:}  \mathcal{B}  \,\rightsquigarrow\,  \IUnt{e}}%
}{
\Delta  \,\vdash\,   \lambda ( \IUmv{x} \!:\! \mathcal{A} ).\; \epsilon   \IUsym{:}   ( \mathcal{A} ) \rightarrow \mathcal{B}   \,\rightsquigarrow\,   \lambda \IUmv{x} \!:\! |  \mathcal{A}  | .\; \IUnt{e} \!:\! |  \mathcal{B}  | }{%
{\IUdrulename{Ela\_Abs}}{}%
}}


\newcommand{\IUdruleElaXXApp}[1]{\IUdrule[#1]{%
\IUpremise{\Delta  \,\vdash\,  \epsilon_{{\mathrm{1}}}  \IUsym{:}   ( \mathcal{A} ) \rightarrow \mathcal{B}   \,\rightsquigarrow\,  \IUnt{e_{{\mathrm{1}}}}}%
\IUpremise{\Delta  \,\vdash\,  \epsilon_{{\mathrm{2}}}  \IUsym{:}  \mathcal{A}  \,\rightsquigarrow\,  \IUnt{e_{{\mathrm{2}}}}}%
}{
\Delta  \,\vdash\,  \epsilon_{{\mathrm{1}}} \, \epsilon_{{\mathrm{2}}}  \IUsym{:}  \mathcal{B}  \,\rightsquigarrow\,  \IUnt{e_{{\mathrm{1}}}} \, \IUnt{e_{{\mathrm{2}}}}}{%
{\IUdrulename{Ela\_App}}{}%
}}


\newcommand{\IUdruleElaXXNAbs}[1]{\IUdrule[#1]{%
\IUpremise{ \Delta \,\vdash\, _{\!\!\!\! \IUmv{x} }\:\: \rho \IUsym{:} \mathcal{P} \,\rightsquigarrow\, \IUnt{letin} \,\dashv\, \Delta' }%
\IUpremise{\Delta'  \,\vdash\,  \epsilon  \IUsym{:}  \mathcal{B}  \,\rightsquigarrow\,  \IUnt{e}}%
}{
\Delta  \,\vdash\,   \lambda \{ \rho \}.\; \epsilon   \IUsym{:}  \IUsym{\{}  \mathcal{P}  \IUsym{\}}  \rightarrow  \mathcal{B}  \,\rightsquigarrow\,   \lambda \IUmv{x} \!:\! |  \mathcal{P}  | .\; \IUnt{letin} \, \IUnt{e} \!:\! |  \mathcal{B}  | }{%
{\IUdrulename{Ela\_NAbs}}{}%
}}


\newcommand{\IUdruleElaXXNApp}[1]{\IUdrule[#1]{%
\IUpremise{\Delta  \,\vdash\,  \epsilon_{{\mathrm{1}}}  \IUsym{:}  \IUsym{\{}  \mathcal{P}  \IUsym{\}}  \rightarrow  \mathcal{B}  \,\rightsquigarrow\,  \IUnt{e_{{\mathrm{1}}}}}%
\IUpremise{\Delta  \,\vdash\,  \epsilon_{{\mathrm{2}}}  \IUsym{:}  \IUsym{\{}  \mathcal{K}  \IUsym{\}}  \,\rightsquigarrow\,  \IUnt{e_{{\mathrm{2}}}}}%
\IUpremise{ \Delta \,\vdash\, _{\!\!\!\! \IUnt{e_{{\mathrm{2}}}} }\:\: \mathcal{P} \,\diamond\, \mathcal{K} \,\rightsquigarrow\, \IUnt{e'_{{\mathrm{2}}}} }%
}{
\Delta  \,\vdash\,  \epsilon_{{\mathrm{1}}} \, \epsilon_{{\mathrm{2}}}  \IUsym{:}  \mathcal{B}  \,\rightsquigarrow\,  \IUnt{e_{{\mathrm{1}}}} \, \IUnt{e'_{{\mathrm{2}}}}}{%
{\IUdrulename{Ela\_NApp}}{}%
}}


\newcommand{\IUdruleElaXXNEmpty}[1]{\IUdrule[#1]{%
}{
\Delta  \,\vdash\,  \IUsym{\{}   \cdot   \IUsym{\}}  \IUsym{:}  \IUsym{\{}   \cdot   \IUsym{\}}  \,\rightsquigarrow\,  \IUsym{\{\}}}{%
{\IUdrulename{Ela\_NEmpty}}{}%
}}


\newcommand{\IUdruleElaXXNField}[1]{\IUdrule[#1]{%
\IUpremise{\Delta  \,\vdash\,  \IUsym{\{}  \kappa  \IUsym{\}}  \IUsym{:}  \IUsym{\{}  \mathcal{K}  \IUsym{\}}  \,\rightsquigarrow\,  \IUnt{e'}}%
\IUpremise{\Delta  \,\vdash\,  \epsilon  \IUsym{:}  \mathcal{A}  \,\rightsquigarrow\,  \IUnt{e}}%
}{
\Delta  \,\vdash\,  \IUsym{\{}  \kappa  ;\,  \ell  \IUsym{=}  \epsilon  \IUsym{\}}  \IUsym{:}  \IUsym{\{}  \mathcal{K}  ;\,  \ell  \IUsym{:}  \mathcal{A}  \IUsym{\}}  \,\rightsquigarrow\,  \IUnt{e'}  \bbcomma  \IUsym{\{}  \ell  \IUsym{:}  |  \mathcal{A}  |  \IUsym{=}  \IUnt{e}  \IUsym{\}}}{%
{\IUdrulename{Ela\_NField}}{}%
}}

\newcommand{\IUdefnelab}[1]{\begin{IUdefnblock}[#1]{$\Delta  \,\vdash\,  \epsilon  \IUsym{:}  \mathcal{A}  \,\rightsquigarrow\,  \IUnt{e}$}{\IUcom{Elaboration}}
\IUusedrule{\IUdruleElaXXInt{}}
\IUusedrule{\IUdruleElaXXVar{}}
\IUusedrule{\IUdruleElaXXAbs{}}
\IUusedrule{\IUdruleElaXXApp{}}
\IUusedrule{\IUdruleElaXXNAbs{}}
\IUusedrule{\IUdruleElaXXNApp{}}
\IUusedrule{\IUdruleElaXXNEmpty{}}
\IUusedrule{\IUdruleElaXXNField{}}
\end{IUdefnblock}}

%% defn pelab
\newcommand{\IUdrulePElaXXEmpty}[1]{\IUdrule[#1]{%
}{
 \Delta \,\vdash\, _{\!\!\!\! \IUmv{x} }\:\:  \cdot  \IUsym{:}  \cdot  \,\rightsquigarrow\, \IUkw{id} \,\dashv\, \Delta }{%
{\IUdrulename{PEla\_Empty}}{}%
}}


\newcommand{\IUdrulePElaXXRequired}[1]{\IUdrule[#1]{%
\IUpremise{ \Delta \,\vdash\, _{\!\!\!\! \IUmv{x} }\:\: \rho \IUsym{:} \mathcal{P} \,\rightsquigarrow\, \IUnt{letin} \,\dashv\, \Delta' }%
}{
 \Delta \,\vdash\, _{\!\!\!\! \IUmv{x} }\:\: \IUsym{(}  \rho  ;\,  \ell  \IUsym{:}  \mathcal{A}  \IUsym{)} \IUsym{:} \IUsym{(}  \mathcal{P}  ;\,  \ell  \IUsym{:}  \mathcal{A}  \IUsym{)} \,\rightsquigarrow\,  \IUnt{letin} \circ \IUkw{let} \, \ell  \IUsym{=}  \IUmv{x}  \IUsym{.}  \ell \, \IUkw{in}  \,\dashv\, \Delta'  ,\,  \ell  \IUsym{:}  \mathcal{A} }{%
{\IUdrulename{PEla\_Required}}{}%
}}


\newcommand{\IUdrulePElaXXOptional}[1]{\IUdrule[#1]{%
\IUpremise{ \Delta \,\vdash\, _{\!\!\!\! \IUmv{x} }\:\: \rho \IUsym{:} \mathcal{P} \,\rightsquigarrow\, \IUnt{letin} \,\dashv\, \Delta' }%
\IUpremise{\Delta'  \,\vdash\,  \epsilon  \IUsym{:}  \mathcal{A}  \,\rightsquigarrow\,  \IUnt{e}}%
}{
 \Delta \,\vdash\, _{\!\!\!\! \IUmv{x} }\:\: \IUsym{(}  \rho  ;\,  \ell  \IUsym{=}  \epsilon  \IUsym{)} \IUsym{:} \IUsym{(}  \mathcal{P}  ;\,  \ell  \IUsym{\mbox{?}}  \IUsym{:}  \mathcal{A}  \IUsym{)} \,\rightsquigarrow\,  \IUnt{letin} \circ \IUkw{let} \, \ell  \IUsym{=}  \IUkw{switch} \, \IUmv{x}  \IUsym{.}  \ell \, \IUkw{as} \, \IUmv{y} \, \IUkw{case} \, |  \mathcal{A}  |  \Rightarrow  \IUmv{y} \, \IUkw{case} \, \IUkw{Null}  \Rightarrow  \IUnt{e} \, \IUkw{in}  \,\dashv\, \Delta'  ,\,  \ell  \IUsym{:}  \mathcal{A} }{%
{\IUdrulename{PEla\_Optional}}{}%
}}

\newcommand{\IUdefnpelab}[1]{\begin{IUdefnblock}[#1]{$ \Delta \,\vdash\, _{\!\!\!\! \IUmv{x} }\:\: \rho \IUsym{:} \mathcal{P} \,\rightsquigarrow\, \IUnt{letin} \,\dashv\, \Delta' $}{\IUcom{Named parameter elaboration}}
\IUusedrule{\IUdrulePElaXXEmpty{}}
\IUusedrule{\IUdrulePElaXXRequired{}}
\IUusedrule{\IUdrulePElaXXOptional{}}
\end{IUdefnblock}}

%% defn pmatch
\newcommand{\IUdrulePMatXXEmpty}[1]{\IUdrule[#1]{%
}{
 \Delta \,\vdash\, _{\!\!\!\! \IUnt{e} }\:\:  \cdot  \,\diamond\, \mathcal{K} \,\rightsquigarrow\, \IUsym{\{\}} }{%
{\IUdrulename{PMat\_Empty}}{}%
}}


\newcommand{\IUdrulePMatXXRequired}[1]{\IUdrule[#1]{%
\IUpremise{ \mathcal{K} :: \ell \Rightarrow \mathcal{A} }%
\IUpremise{ \Delta \,\vdash\, _{\!\!\!\! \IUnt{e} }\:\: \mathcal{P} \,\diamond\, \mathcal{K} \,\rightsquigarrow\, \IUnt{e'} }%
}{
 \Delta \,\vdash\, _{\!\!\!\! \IUnt{e} }\:\: \IUsym{(}  \mathcal{P}  ;\,  \ell  \IUsym{:}  \mathcal{A}  \IUsym{)} \,\diamond\, \mathcal{K} \,\rightsquigarrow\, \IUnt{e'}  \bbcomma  \IUsym{\{}  \ell  \IUsym{:}  |  \mathcal{A}  |  \IUsym{=}  \IUnt{e}  \IUsym{.}  \ell  \IUsym{\}} }{%
{\IUdrulename{PMat\_Required}}{}%
}}


\newcommand{\IUdrulePMatXXPresent}[1]{\IUdrule[#1]{%
\IUpremise{ \mathcal{K} :: \ell \Rightarrow \mathcal{A} }%
\IUpremise{ \Delta \,\vdash\, _{\!\!\!\! \IUnt{e} }\:\: \mathcal{P} \,\diamond\, \mathcal{K} \,\rightsquigarrow\, \IUnt{e'} }%
}{
 \Delta \,\vdash\, _{\!\!\!\! \IUnt{e} }\:\: \IUsym{(}  \mathcal{P}  ;\,  \ell  \IUsym{\mbox{?}}  \IUsym{:}  \mathcal{A}  \IUsym{)} \,\diamond\, \mathcal{K} \,\rightsquigarrow\, \IUnt{e'}  \bbcomma  \IUsym{\{}  \ell  \IUsym{:}  |  \mathcal{A}  |  \lor  \IUkw{Null}  \IUsym{=}  \IUnt{e}  \IUsym{.}  \ell  \IUsym{\}} }{%
{\IUdrulename{PMat\_Present}}{}%
}}


\newcommand{\IUdrulePMatXXAbsent}[1]{\IUdrule[#1]{%
\IUpremise{ \mathcal{K} :: \ell \nRightarrow }%
\IUpremise{ \Delta \,\vdash\, _{\!\!\!\! \IUnt{e} }\:\: \mathcal{P} \,\diamond\, \mathcal{K} \,\rightsquigarrow\, \IUnt{e'} }%
}{
 \Delta \,\vdash\, _{\!\!\!\! \IUnt{e} }\:\: \IUsym{(}  \mathcal{P}  ;\,  \ell  \IUsym{\mbox{?}}  \IUsym{:}  \mathcal{A}  \IUsym{)} \,\diamond\, \mathcal{K} \,\rightsquigarrow\, \IUnt{e'}  \bbcomma  \IUsym{\{}  \ell  \IUsym{:}  |  \mathcal{A}  |  \lor  \IUkw{Null}  \IUsym{=}  \IUkw{null}  \IUsym{\}} }{%
{\IUdrulename{PMat\_Absent}}{}%
}}

\newcommand{\IUdefnpmatch}[1]{\begin{IUdefnblock}[#1]{$ \Delta \,\vdash\, _{\!\!\!\! \IUnt{e} }\:\: \mathcal{P} \,\diamond\, \mathcal{K} \,\rightsquigarrow\, \IUnt{e'} $}{\IUcom{Call site rewriting}}
\IUusedrule{\IUdrulePMatXXEmpty{}}
\IUusedrule{\IUdrulePMatXXRequired{}}
\IUusedrule{\IUdrulePMatXXPresent{}}
\IUusedrule{\IUdrulePMatXXAbsent{}}
\end{IUdefnblock}}

%% defn lookup
\newcommand{\IUdruleLUXXPresent}[1]{\IUdrule[#1]{%
\IUpremise{ \mathcal{K} :: \ell \nRightarrow }%
}{
 \IUsym{(}  \mathcal{K}  ;\,  \ell  \IUsym{:}  \mathcal{A}  \IUsym{)} :: \ell \Rightarrow \mathcal{A} }{%
{\IUdrulename{LU\_Present}}{}%
}}


\newcommand{\IUdruleLUXXAbsent}[1]{\IUdrule[#1]{%
\IUpremise{\ell'  \neq  \ell}%
\IUpremise{ \mathcal{K} :: \ell \Rightarrow \mathcal{A} }%
}{
 \IUsym{(}  \mathcal{K}  ;\,  \ell'  \IUsym{:}  \mathcal{B}  \IUsym{)} :: \ell \Rightarrow \mathcal{A} }{%
{\IUdrulename{LU\_Absent}}{}%
}}

\newcommand{\IUdefnlookup}[1]{\begin{IUdefnblock}[#1]{$ \mathcal{K} :: \ell \Rightarrow \mathcal{A} $}{\IUcom{Successful lookup}}
\IUusedrule{\IUdruleLUXXPresent{}}
\IUusedrule{\IUdruleLUXXAbsent{}}
\end{IUdefnblock}}

%% defn lookdown
\newcommand{\IUdruleLDXXEmpty}[1]{\IUdrule[#1]{%
}{
  \cdot  :: \ell \nRightarrow }{%
{\IUdrulename{LD\_Empty}}{}%
}}


\newcommand{\IUdruleLDXXAbsent}[1]{\IUdrule[#1]{%
\IUpremise{\ell'  \neq  \ell}%
\IUpremise{ \mathcal{K} :: \ell \nRightarrow }%
}{
 \IUsym{(}  \mathcal{K}  ;\,  \ell'  \IUsym{:}  \mathcal{A}  \IUsym{)} :: \ell \nRightarrow }{%
{\IUdrulename{LD\_Absent}}{}%
}}

\newcommand{\IUdefnlookdown}[1]{\begin{IUdefnblock}[#1]{$ \mathcal{K} :: \ell \nRightarrow $}{\IUcom{Failed lookup}}
\IUusedrule{\IUdruleLDXXEmpty{}}
\IUusedrule{\IUdruleLDXXAbsent{}}
\end{IUdefnblock}}


\newcommand{\IUdefnsSource}{
\IUdefnelab{}\IUdefnpelab{}\IUdefnpmatch{}\IUdefnlookup{}\IUdefnlookdown{}}

\newcommand{\IUdefnss}{
\IUfundefnsTrans
\IUfundefnsCtxTrans
\IUfundefnsDynType
\IUdefnsTarget
\IUdefnsSemantics
\IUdefnsSource
}

\newcommand{\IUall}{\IUmetavars\\[0pt]
\IUgrammar\\[5.0mm]
\IUdefnss}

